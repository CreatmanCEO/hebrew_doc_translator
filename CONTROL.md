# Переводчик документов с иврита - Журнал контроля разработки

## Описание проекта
Веб-приложение для перевода документов с иврита на русский и английский языки с сохранением оригинального форматирования и обработкой смешанного контента.

## Статус проекта
**Текущий этап:** Настройка тестирования  
**Последнее обновление:** 01.02.2025  
**Статус разработки:** В активной разработке

## Изменения и задачи

### Последние изменения (01.02.2025)
1. Обновлена система тестирования:
   - Разделены unit и интеграционные тесты
   - Добавлено мокирование для тестов
   - Исправлены проблемы с Jest globals
   - Улучшена обработка rate limiting в тестах

2. Структура тестов:
   - Unit тесты: tests/unit/services/
   - Интеграционные тесты: tests/services/
   - Добавлено мокирование времени
   - Увеличены таймауты для долгих тестов

### Предыдущие изменения (27.01.2025)
1. Исправлены ошибки линтера:
   - Добавлен Bull в translate.js
   - Исправлен импорт необходимых модулей
   - Удалены неиспользуемые переменные
   - Заменен file-type на mime-types
   - Обновлены зависимости проекта

## Архитектура

### Backend (Node.js + Express)
#### Core Services (Реализовано)
- DocumentAnalyzer - анализ документов
- LayoutExtractor - извлечение разметки
- TextExtractor - извлечение текста и OCR
- Translator - перевод текста
  - Базовый перевод текста
  - Обработка смешанного контента
  - Rate limiting и очереди
  - Обработка ошибок и повторные попытки
- DocumentGenerator - генерация документов

#### API (В разработке)
- POST /api/translate
- GET /api/status/:jobId
- GET /api/download/:jobId

### Frontend (React)
#### Компоненты (Реализовано)
- DocumentUpload - загрузка файлов
- DocumentPreview - предпросмотр
- TranslationProgress - отслеживание прогресса

## Текущий функционал
1. Загрузка документов:
   - [x] PDF файлы
   - [x] DOC/DOCX файлы
   - [x] Валидация форматов
   - [x] Проверка размера

2. Обработка документов:
   - [x] Извлечение текста
   - [x] OCR для иврита
   - [x] Определение языка
   - [x] Сохранение форматирования

3. Перевод:
   - [x] Перевод с иврита
   - [x] Сохранение оригинального текста
   - [x] Обработка смешанного контента
   - [x] Rate limiting и очереди
   - [x] Повторные попытки при ошибках

## План разработки

### Этап 1 - Инфраструктура (Текущий)
- [x] Линтинг и форматирование
- [x] Основные тесты сервисов
- [ ] Тесты API endpoints
- [ ] Тесты интеграции с базой данных
- [ ] GitHub Actions для CI/CD

### Этап 2 - Улучшение функционала
- [ ] Кэширование переводов
- [ ] Пакетная обработка
- [ ] Предпросмотр в реальном времени
- [ ] Статистика переводов

### Этап 3 - Оптимизация
- [ ] Оптимизация производительности
- [ ] Улучшение качества OCR
- [ ] Мониторинг ошибок
- [ ] Метрики и логирование

## Тестирование
### Unit тесты
1. Translator Service:
   - Базовый перевод
   - Обработка смешанного контента
   - Обработка ошибок
   - Моки для внешних сервисов

2. Document Services:
   - Анализ документов
   - Извлечение текста
   - Генерация документов

### Интеграционные тесты
1. Translator Service:
   - Rate limiting
   - Очереди
   - Документы целиком
   - Реальные запросы к API

2. API Endpoints:
   - Загрузка файлов
   - Статус перевода
   - Скачивание результатов

## Зависимости
### Основные
- Node.js >= 18.0.0
- Redis для очередей
- bull для обработки задач
- express-rate-limit для ограничения запросов
- multer для обработки файлов
- socket.io для реального времени
- mammoth для обработки DOCX
- pdf.js-extract для обработки PDF
- @azure/ai-translator для перевода

### Разработка
- eslint для линтинга
- prettier для форматирования
- jest для unit тестов
- vitest для компонентных тестов
- testcontainers для интеграционных тестов

## Развертывание
1. Клонировать репозиторий
2. Установить зависимости: `npm install`
3. Настроить .env
4. Запустить: `npm run dev:full`

## Тестирование
1. Unit тесты: `npm run test:unit`
2. Интеграционные тесты: `npm run test:integration`
3. Все тесты: `npm test`

## Известные проблемы
1. Ограничения:
   - Максимальный размер файла: 10MB
   - Rate limiting: 10 запросов в минуту
   - Таймаут перевода: 30 секунд

2. Требования:
   - Качество сканов для OCR
   - Корректная кодировка иврита
   - Стабильное подключение к интернету

## История изменений
### 01.02.2025
- Обновление системы тестирования
- Разделение unit и интеграционных тестов
- Исправление проблем с Jest

### 27.01.2025
- Исправление ошибок линтера
- Обновление зависимостей
- Реструктуризация кода

### 26.01.2025
- Инициализация проекта
- Базовая структура документа
- Настройка процесса разработки